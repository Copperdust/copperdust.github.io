<html>

<head>
  <title>Pokemon Multiple Choice for Sleep</title>

  <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

  <script>
    // Define constants
    const api = 'https://pokeapi.co/api/v2/';
    const possibilities = 4;
  </script>
</head>


<body class="bg-dark text-white" >
  <div class="container-fluid">
    <div class='offset-4 col-md-4'>
      <h1>Poke Lullaby</h1>
      <section class="main">
        <div class="top d-flex align-items-center">
          <div class="bad">0</div>
          <div class="images"><img id="mainImage" src="https://upload.wikimedia.org/wikipedia/commons/5/55/Question_Mark.svg" alt="?"></div>
          <div class="good">0</div>
        </div>
        <div class="controls">       
          <script>
            for (let index = 1; index < possibilities + 1; index++) {
              document.write('<div class="row justify-content-md-center"><button id="b'+(index)+'" class="btn btn-primary">name goes here</button></div>');
            }
          </script>
        </div>
      </section>
    </div>
  </div>
  <audio controls id="audio" class="d-none">
    <source src="./pokemon-lofi-music.mp3" type="audio/mp3">
  </audio>
  
  <script>
    // Get one pokemon
    function getOnePokemon() {
      endpoint = 'pokemon/';
      random = Math.floor(Math.random() * Math.floor(100)) + 1;
      return $.ajax({
        url: api + endpoint + random,
      });
    }
    // Main function
    async function newChallenge() {
      // Get 4 new pokemon
      var pokes = [];
      for (let index = 0; index < possibilities; index++) {
        pokes.push(getOnePokemon());
      }
      var incorrect = [];
      Promise.all(pokes).then((values) => {
        // Choose one of the four as the correct answer
        for (let index = 0; index < possibilities; index++) {
          if (index == 0) {
            var correct = values[index];
          } else {
            incorrect.push(values[index]);
          }
        }
        // Choose correct button ID
        var correctId = Math.floor(Math.random() * Math.floor(4));
        // Load the names into the buttons
        for (let index = 0; index < possibilities; index++) {
          if (index == correctId) {
            $('#b' + (index+1))
              .text(correct.name)
              // Mark the button with the correct answer
              .addClass('correct')
              .removeClass('incorrect');
            // Set the image for the correct answer
            $('#mainImage').attr('src',correct.sprites.front_default);
          } else {
            let poke = incorrect.pop();
            $('#b' + (index+1))
              .text(poke.name)
              .removeClass('correct')
              .addClass('incorrect');
          }
        }
      });
    }
    // On image finished loading
    $('#mainImage').on('load', function() {
      unBlockInputs();
    });
    // Block inputs
    function unBlockInputs() {
      for (let index = 1; index < possibilities + 1; index++) {
        $('#b'+index).prop('disabled', false);
      }
    }
    // Block inputs
    function blockInputs() {
      for (let index = 1; index < possibilities + 1; index++) {
        $('#b'+index).prop('disabled', true);
      }
    }
    // Increase the counter for good or bad
    function increaseCounter( selector ) {
      var current = parseInt($(selector).text());
      $(selector).text(++current);
    }
    // Sleep
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    // On click event
    // const audio = $('#audio')
    // If good button is clicked, increase good counter
    $(document).on('click', '.correct', async function (e) {
      blockInputs();
      increaseCounter('.good');
      await sleep(500);
      // audio.play()
      // Call this function again
      newChallenge();
    });
    // If bad button is clicked, increase bad counter
    $(document).on('click', '.incorrect', async function (e) {
      blockInputs();
      increaseCounter('.bad');
      await sleep(500);
      // audio.pause()
      // Call this function again
      newChallenge();
    });
    newChallenge();
  </script>
</body>

</html>